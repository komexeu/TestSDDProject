# 功能規格：點餐系統流程

**功能分支**：`001-order-system-flow`
**建立日期**：2025-10-21
**狀態**：草稿
**輸入**：我要設計一個系統 點餐系統 三方： User / 櫃檯 / 廚房 點餐流程：User Line點餐>User狀態（已點餐）> 櫃檯接收 >  櫃檯確認 >User狀態（已確認訂單） >  廚房接單 >  櫃檯收到廚房通知 >  User狀態（製作中）> 櫃檯收到餐點 > 櫃檯點選完成 > User狀態（可取餐）> User完成取餐 > User狀態（已取餐完成）
**所有規格、計畫、使用者文件必須以繁體中文（zh-TW）撰寫。**

## Clarifications
### Session 2025-10-21
- Q: 訂單狀態生命週期與異常處理 → A: 明確定義所有狀態轉換規則，並補充異常/例外情境
- Q: 會員查詢訂單狀態時，D1 是否可直接作為查詢來源以節省資源？ → A: 會員查詢訂單狀態時直接查詢 D1，無需額外快取或輪詢，能最大化資源利用率並簡化架構。

## 使用者情境與測試（必填）

### 使用者故事 1 - 用戶點餐（優先級：P1）
用戶可透過 Line 進行點餐，送出訂單後狀態顯示「已點餐」。
**優先原因**：此流程為系統入口，影響所有後續動作。
**獨立測試**：用戶送出訂單後，狀態正確顯示「已點餐」。
**驗收情境**：
1. 前提：用戶已登入Line，動作：選擇餐點並送出，結果：訂單狀態顯示「已點餐」。

### 使用者故事 2 - 櫃檯確認訂單（優先級：P2）
櫃檯收到訂單後可確認，確認後用戶狀態變為「已確認訂單」。
**優先原因**：櫃檯確認為流程關鍵節點，避免誤單。
**獨立測試**：櫃檯確認後，用戶狀態正確更新。
**驗收情境**：
1. 前提：櫃檯收到新訂單，動作：點選確認，結果：用戶狀態顯示「已確認訂單」。

### 使用者故事 3 - 廚房接單與製作（優先級：P3）
廚房接單後通知櫃檯，櫃檯通知用戶「製作中」。
**優先原因**：確保餐點製作流程透明。
**獨立測試**：廚房接單後，櫃檯與用戶狀態正確更新。
**驗收情境**：
1. 前提：廚房收到訂單，動作：通知櫃檯，結果：用戶狀態顯示「製作中」。

### 使用者故事 4 - 完成取餐（優先級：P4）
櫃檯收到餐點後點選完成，用戶狀態顯示「可取餐」，用戶完成取餐後狀態顯示「已取餐完成」。
**優先原因**：流程結束，影響用戶滿意度。
**獨立測試**：櫃檯完成後，用戶狀態正確更新。
**驗收情境**：
1. 前提：櫃檯收到餐點，動作：點選完成，結果：用戶狀態顯示「可取餐」。
2. 前提：用戶取餐，動作：點選完成，結果：用戶狀態顯示「已取餐完成」。

## 功能需求
1. 用戶可於Line介面選擇餐點並送出訂單。
2. 櫃檯可接收並確認訂單。
3. 廚房可接收訂單並通知櫃檯。
4. 用戶訂單狀態依流程自動更新。
5. 櫃檯可標記餐點完成，通知用戶取餐。
6. 用戶完成取餐後，狀態顯示「已取餐完成」。
7. 訂單狀態轉換規則：
   - 已點餐 → 已確認訂單 → 製作中 → 可取餐 → 已取餐完成
   - 異常/例外情境：
     - 訂單取消：用戶或櫃檯可於「已點餐」或「已確認訂單」狀態下取消訂單，狀態顯示「已取消」。
     - 重複送單：系統須檢查同一用戶於短時間內重複送單，提示用戶並避免重複建立訂單。
     - 廚房拒單/失敗：廚房可拒絕接單，訂單狀態顯示「製作失敗」，並通知櫃檯與用戶。
     - 其他異常：如系統錯誤，狀態顯示「異常」，並提示用戶聯絡櫃檯。
8. 會員查詢訂單狀態時，直接查詢 D1 資料庫，無需額外快取或輪詢，確保查詢即時且節省資源。

## 成功標準
1. 用戶可於3步驟內完成點餐。
2. 櫃檯確認訂單後，平均1秒內用戶狀態更新。
3. 廚房通知後，櫃檯與用戶狀態同步更新。
4. 95%訂單流程無誤，狀態正確。
5. 用戶滿意度調查達90%以上。
6. 所有異常/例外情境皆有明確狀態顯示與提示。

## 關鍵實體
- 用戶（User）
- 訂單（Order）
- 餐點（Item）
- 狀態（Status）
- 櫃檯（Counter）
- 廚房（Kitchen）

## 假設
- 用戶皆已註冊Line帳號。
- 櫃檯與廚房皆有系統操作介面。
- 訂單狀態依上述流程自動推進。

