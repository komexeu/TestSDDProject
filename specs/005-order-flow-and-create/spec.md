# 功能規格：點餐流程與建立訂單（合併版）

**功能分支**：`005-order-flow-and-create`
**建立日期**：2025-11-14
**狀態**：草稿
**說明**：本文件整合「點餐系統流程」與「建立訂單」兩大功能規格，涵蓋完整點餐流程與訂單建立、驗證、通知等細節。

---

## 一、點餐系統流程（原 001-order-system-flow）

### 使用者情境與測試

#### 使用者故事 1 - 用戶點餐（P1）
用戶可透過 Line 進行點餐，送出訂單後狀態顯示「已點餐」。
- 驗收：用戶送出訂單後，狀態正確顯示「已點餐」。

#### 使用者故事 2 - 櫃檯確認訂單（P2）
櫃檯收到訂單後可確認，確認後用戶狀態變為「已確認訂單」。
- 驗收：櫃檯確認後，用戶狀態正確更新。

#### 使用者故事 3 - 廚房接單與製作（P3）
廚房接單後通知櫃檯，櫃檯通知用戶「製作中」。
- 驗收：廚房接單後，櫃檯與用戶狀態正確更新。

#### 使用者故事 4 - 完成取餐（P4）
櫃檯收到餐點後點選完成，用戶狀態顯示「可取餐」，用戶完成取餐後狀態顯示「已取餐完成」。
- 驗收：櫃檯完成後，用戶狀態正確更新。

### 功能需求
1. 用戶可於Line介面選擇餐點並送出訂單。
2. 櫃檯可接收並確認訂單。
3. 廚房可接收訂單並通知櫃檯。
4. 用戶訂單狀態依流程自動更新。
5. 櫃檯可標記餐點完成，通知用戶取餐。
6. 用戶完成取餐後，狀態顯示「已取餐完成」。
7. 訂單狀態轉換規則：
   - 已點餐 → 已確認訂單 → 製作中 → 可取餐 → 已取餐完成
   - 異常/例外情境：
     - 訂單取消、重複送單、廚房拒單/失敗、系統錯誤
8. 會員查詢訂單狀態時，直接查詢 D1 資料庫。

### 成功標準
- 用戶可於3步驟內完成點餐。
- 櫃檯確認訂單後，平均1秒內用戶狀態更新。
- 95%訂單流程無誤，狀態正確。
- 用戶滿意度調查達90%以上。
- 所有異常/例外情境皆有明確狀態顯示與提示。

### 關鍵實體
- 用戶（User）、訂單（Order）、餐點（Item）、狀態（Status）、櫃檯（Counter）、廚房（Kitchen）

---

## 二、建立訂單功能（原 004-create-order）

### 使用者情境與測試

#### 使用者故事 1 - 建立新訂單（P1）
作為顧客，能夠建立新訂單，購買所需商品。
- 驗收：登入後選擇商品並送出訂單，系統產生新訂單並顯示明細。
- 庫存不足時，系統提示無法建立訂單。

#### 使用者故事 2 - 訂單資料驗證（P2）
系統驗證訂單資料（如收件資訊、商品數量），避免錯誤資料導致訂單失敗。
- 驗收：資料缺漏或錯誤時，系統提示並阻止送出。

#### 使用者故事 3 - 訂單建立通知（P3）
訂單建立成功後收到通知，確認訂單已成立。
- 驗收：訂單建立成功後，系統發送通知給用戶。

#### 邊界情境
- 商品庫存為 0 時阻止下單。
- 同一用戶同時送出多筆訂單，避免重複建立。
- 訂單資料缺漏或格式錯誤時明確提示。
- 訂單金額超過單筆上限、付款失敗等。

### 功能需求
- 系統必須允許已登入用戶建立新訂單。
- 系統必須驗證訂單資料完整性與正確性。
- 系統必須檢查商品庫存，庫存不足時禁止下單。
- 訂單建立成功後，必須顯示訂單明細給用戶。
- 訂單建立成功後，必須發送通知給用戶。
- 系統必須處理付款失敗時的訂單狀態。
- 系統必須防止同一用戶重複建立相同內容訂單。
- 系統必須永久保留訂單資料（除非法規另有規定）。

### 關鍵實體
- 訂單（Order）：訂單編號、用戶資訊、商品明細、金額、狀態、建立時間等。
- 商品（Product）：商品編號、名稱、庫存數量、價格等。
- 用戶（User）：用戶編號、姓名、聯絡資訊等。

### 成功標準
- 90% 以上訂單可於 1 分鐘內完成建立。
- 訂單資料錯誤時，100% 給予明確錯誤提示。
- 訂單建立成功後，100% 用戶可收到通知。
- 用戶可於訂單建立後即時查詢訂單明細。
- 付款失敗訂單 100% 被正確標記並通知用戶。

### 假設與限制
- 用戶已登入且有權限下單。
- 商品資料與庫存即時同步。
- 訂單通知方式預設為 email。

---

> 本文件整合自 specs/001-order-system-flow/spec.md 及 specs/004-create-order/spec.md，請依實際需求持續補充細節。
